https://thayer.github.io/engs50/Notes/crawler/
2
21448
<!DOCTYPEhtml><html><head><metacharset="utf-8"><metahttp-equiv="X-UA-Compatible"content="IE=edge"><metaname="viewport"content="width=device-width,initial-scale=1"><title>TSECrawlerdesignandimplementation</title><metaname="description"content="InEngs50youwilllearnhowtodesign&buildlarge,reliable,maintainable,andunderstandablesoftwaresystems.IntheprocessyouwilllearntoprograminCwithUnixdevelopmenttools."><linkrel="shortcuticon"href="/engs50/50.png"/><linkrel="stylesheet"href="/engs50/css/main.css"><linkrel="canonical"href="/engs50/Notes/crawler/"></head><body><headerclass="site-header"><aclass="site-title"href="/engs50/"><imgwidth=48align=centersrc="/engs50/50.png"alt="icon">Engs50(CS50)</a><navclass="site-nav">[<ahref="/engs50/Labs/">Labs</a>][<ahref="/engs50/Notes/">Notes</a>][<ahref="/engs50/Reading/">Reading</a>][<ahref="/engs50/Resources/">Resources</a>][<ahref="/engs50/Examples/">Examples</a>]</nav></header><divclass="page-content"><divclass="wrapper"><articleclass="post"><headerclass="post-header"><h1class="post-title">TSECrawlerdesignandimplementation</h1></header><divclass="post-content"><h3id="goals">Goals</h3><ul><li>TounderstandthespecificationsfortheTinySearchEngine(TSE)</li><li>TodevelopanimplementationplanfortheTSECrawler</li><li>TodemonstratetheexecutionofoneCrawlersolution</li></ul><p>MyfirstTerminal<ahref="/engs50/Notes/crawler/script1.txt">script</a>showsashortrunofcrawleroverthecs50homedirectory.</p><p>MysecondTerminal<ahref="/engs50/Notes/crawler/script2.txt">script</a>showssomeshortrunsofcrawleroverthesmall‘letters’playground,thenarunoverthe‘wikipedia’playground;IeventuallykilledthemaxDepth=2crawlbecauseittakesalongtimetofinish.</p><h2id="specifications">Specifications</h2><p>Agoodsoftwareimplementationrequiresagoodsoftwaredesign,andagoodsoftwaredesignmustbebasedonaclearsetofrequirements.Wethinkaboutthese<em>specifications</em>asasortof“contract”betweentheprogrammer(whowritesthecode)andthecustomer(theultimateuserofthesoftware).Thus,weneedthreespecs:</p><ul><li><strong>Requirementsspec</strong>:specifieswhatthesoftwaremustdo</li><li><strong>Designspec</strong>:specifiesthestructureofthesoftwareinalanguage-independent,machine-dependentway</li><li><strong>Implementationspec</strong>:specifiesthelanguage-dependent,machine-dependentdetailsoftheimplementation.</li></ul><p>We’lltakeacloserlookatthedesignprocessinthenextlecture.Fortoday,let’sapplythisapproachtotheTSE.</p><h2id="tiny-search-engine-tse">TinySearchEngine(TSE)</h2><p>OurTinySearchEngine(TSE)designisinspiredbythematerialinthepaper<em><ahref="/engs50/Reading/searchingtheweb.pdf">SearchingtheWeb</a></em>,byArvindArasu,JunghooCho,HectorGarcia-Molina,AndreasPaepcke,andSriramRaghavan(StanfordUniversity);<em>ACMTransactionsonInternetTechnology(TOIT),</em>Volume1,Issue1(August2001).</p><h3id="tse-requirements-spec">TSERequirementsSpec</h3><p>TheTinySearchEngine(TSE)<strong>shall</strong>consistofthreesubsystems:</p><ol><li><strong>crawler</strong>,whichcrawlsthewebfromagivenseedtoagivenmaxDepthandcachesthecontentofthepagesitfinds,onepageperfile,inagivendirectory.</li><li><strong>indexer</strong>,whichreadsfilesfromthegivendirectory,buildsanindexthatmapsfrom<em>words</em>to<em>pages</em>(URLs),andwritesthatindextoagivenfile.</li><li><strong>querier</strong>,whichreadstheindexfromagivenfile,andaqueryexpressedasasetofwordsoptionallycombinedby(AND,OR),andoutputsarankedlistofpages(URLs)inwhichthegivencombinationofwordsappear.</li></ol><p>Eachsubsystemisastandaloneprogramexecutedfromthecommandline,buttheyinter-connectthroughfilesinthefilesystem.</p><blockquote><p>Inaspecdocument,wewrite<em>shalldo</em>tomean<em>mustdo</em>.</p></blockquote><p>We’lllookdeeperattherequirementsfortheeachsubsystem,later.First,let’sgotothenextlevelontheoverallTSE:theDesignSpec.</p><h3id="tse-design-spec">TSEDesignSpec</h3><p>Theoverallarchitecturepresentedbelowshowsthemodulardecompositionofthesystem:</p><p><imgsrc="/engs50/Notes/crawler/designandcrawler1x.png"alt="TinySearchEnginemodulardesign"/></p><hr/><p>TheabovediagramisconsistentwiththeRequirementsSpec:wecanclearlyseethreesub-systems,theirinterconnectionthroughfiles,andtheuserinterfaceforsubmittingqueriestothequerier.Thequeriersubsystemhasaninternal<em>ranking</em>module,whichweanticipatemightbeseparatefromthe<em>queryprocessor</em>module;we’lllookmorecloselywhenwecometothequerierdesign.</p><p>Next,wedescribeeachsub-systemanditshigh-leveldesign.</p><p>The<strong>crawler</strong>crawlsawebsiteandretrieveswebpagesstartingwithaspecifiedURL.Itparsestheinitialwebpage,extractsanyembedded<codeclass="language-plaintexthighlighter-rouge">href</code>URLsandretrievesthosepages,andcrawlsthepagesfoundatthoseURLs,butlimitingitselfto<codeclass="language-plaintexthighlighter-rouge">maxDepth</code>hopsfromtheseedURL.Whenthecrawlerprocessiscomplete,theindexingofthecollecteddocumentscanbegin.</p><p>The<strong>indexer</strong>extractsallthekeywordsforeachstoredwebpageandcreatesalookuptablethatmapseachwordfoundtoallthedocuments(webpages)wherethewordwasfound.</p><p>The<strong>queryengine</strong>respondstorequests(queries)fromusers.The<em>queryprocessormodule</em>loadstheindexandsearchesforpagesthatincludethesearchkeywords.Becausetheremaybemanyhits,weneeda<em>rankingmodule</em>toranktheresults(e.g.,hightolownumberofinstancesofakeywordonapage).</p><h3id="tse-crawler-specs">TSECrawlerSpecs</h3><p>We’lllookdeeperattherequirementsfortheindexerandquerierlater.Rightnow,let’sfocusonthecrawler:</p><ul><li><strong><ahref="/engs50/Labs/Lab4/REQUIREMENTS.html">RequirementsSpec</a></strong>.</li><li><strong><ahref="/engs50/Labs/Lab4/DESIGN.html">DesignSpec</a></strong>.</li><li><strong>Implementationspec</strong>:TheDesignSpecdescribesabstractions-abstractdatastructures,andpseudocode.ThesamedesigncouldbeimplementedinCorJavaoranotherlanguage.TheImplementationSpecgetsmorespecific.Itis<em>language,operatingsystem,andhardwaredependent</em>.Theimplementationspecincludesmanyorallofthesetopics:<ul><li>Detailedpseudocodeforeachoftheobjects/components/functions,</li><li>DefinitionofdetailedAPIs,interfaces,functionprototypesandtheirparameters,</li><li>Datastructures(e.g.,<codeclass="language-plaintexthighlighter-rouge">struct</code>namesandmembers),</li><li>Securityandprivacyproperties,</li><li>Errorhandlingandrecovery,</li><li>Resourcemanagement,</li><li>Persistantstorage(files,database,etc).</li></ul></li></ul><p>The<ahref="/engs50/Labs/Lab3">Lab3</a>assignmentiswrittenlikeanimplementationspec,rightdowntothespecificfunctionprototypes.</p><p>YouneedtowritetheImplementationspecfortheCrawlerinLab4.</p><h2id="demonstration">Demonstration</h2><h3id="crawler-execution-and-output">Crawlerexecutionandoutput</h3><p>BelowisasnippetofwhentheprogramstartstocrawltheCS50websitetoadepthof1.Thecrawlerprintsstatusinformationasitgoesalong.</p><blockquote><p>Note,youmightconsidercoveringthisdebuggingprint-outcodeinan<codeclass="language-plaintexthighlighter-rouge">#ifdef</code>blockthatcanbetriggeredbyacompile-timeswitch.Seethe<ahref="../12/preprocessor.html">Lectureextra</a>aboutthistrick.</p></blockquote><divclass="language-plaintexthighlighter-rouge"><divclass="highlight"><preclass="highlight"><code>$./crawlerhttp://old-www.cs.dartmouth.edu/~cs50/index.htmldata10Fetched:http://old-www.cs.dartmouth.edu/~cs50/index.html0Saved:http://old-www.cs.dartmouth.edu/~cs50/index.html0Scanning:http://old-www.cs.dartmouth.edu/~cs50/index.html0Found:http://old-www.cs.dartmouth.edu/~cs50/0Added:http://old-www.cs.dartmouth.edu/~cs50/0Found:https://canvas.dartmouth.edu/courses/148150IgnExtrn:https://canvas.dartmouth.edu/courses/148150Found:https://piazza.com/dartmouth/spring2017/cosc050sp17/home0IgnExtrn:https://piazza.com/dartmouth/spring2017/cosc050sp17/home0Found:http://old-www.cs.dartmouth.edu/~cs50/Schedule.pdf0IgnExtrn:http://old-www.cs.dartmouth.edu/~cs50/Schedule.pdf0Found:http://www.cs.dartmouth.edu/~cs50/Logistics/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Logistics/0Found:http://www.cs.dartmouth.edu/~cs50/Lectures/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Lectures/0Found:http://www.cs.dartmouth.edu/~cs50/Reading/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Reading/0Found:http://www.cs.dartmouth.edu/~cs50/examples/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/examples/0Found:http://www.cs.dartmouth.edu/~cs50/Sections/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Sections/0Found:http://www.cs.dartmouth.edu/~cs50/Labs/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Labs/0Found:http://www.cs.dartmouth.edu/~cs50/Labs/Project/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Labs/Project/0Found:https://gitlab.cs.dartmouth.edu0IgnExtrn:https://gitlab.cs.dartmouth.edu0Found:http://www.cs.dartmouth.edu/~cs50/Resources/0IgnExtrn:http://www.cs.dartmouth.edu/~cs50/Resources/0Found:http://old-www.cs.dartmouth.edu/~dfk/0Added:http://old-www.cs.dartmouth.edu/~dfk/1Fetched:http://old-www.cs.dartmouth.edu/~dfk/1Saved:http://old-www.cs.dartmouth.edu/~dfk/1Fetched:http://old-www.cs.dartmouth.edu/~cs50/1Saved:http://old-www.cs.dartmouth.edu/~cs50/</code></pre></div></div><p>NoticehowIprintedthedepthofthecurrentcrawlatleft,thenindentedslightlybasedonthecurrentdepth,thenprintedasinglewordmeanttoindicatewhatisbeingdone,thenprintedtheURL.Byensuringaconsistentformat,andchoosingasimple/uniquewordforeachtypeofline,Icanpost-processtheoutputwith<codeclass="language-plaintexthighlighter-rouge">grep</code>,<codeclass="language-plaintexthighlighter-rouge">awk</code>,andsoforth,enablingmetorunvariouschecksontheoutputofthecrawler.Muchbetterthanamish-mashofarbitraryoutputformats!</p><p>Tomakethiseasy,Iwroteasimplefunctiontoprintthoselines:</p><divclass="language-chighlighter-rouge"><divclass="highlight"><preclass="highlight"><code><spanclass="c1">//logoneword(1-9chars)aboutagivenurl</span><spanclass="kr">inline</span><spanclass="k">static</span><spanclass="kt">void</span><spanclass="nf">logr</span><spanclass="p">(</span><spanclass="k">const</span><spanclass="kt">char</span><spanclass="o">*</span><spanclass="n">word</span><spanclass="p">,</span><spanclass="k">const</span><spanclass="kt">int</span><spanclass="n">depth</span><spanclass="p">,</span><spanclass="k">const</span><spanclass="kt">char</span><spanclass="o">*</span><spanclass="n">url</span><spanclass="p">)</span><spanclass="p">{</span><spanclass="n">printf</span><spanclass="p">(</span><spanclass="s">"%2d%*s%9s:%s</span><spanclass="se">\n</span><spanclass="s">"</span><spanclass="p">,</span><spanclass="n">depth</span><spanclass="p">,</span><spanclass="n">depth</span><spanclass="p">,</span><spanclass="s">""</span><spanclass="p">,</span><spanclass="n">word</span><spanclass="p">,</span><spanclass="n">url</span><spanclass="p">);</span><spanclass="p">}</span></code></pre></div></div><p>Ithushavejustone<codeclass="language-plaintexthighlighter-rouge">printf</code>call,andifIwanttotweaktheformat,Ijustneedtoeditoneplaceandnoteverylog-type<codeclass="language-plaintexthighlighter-rouge">printf</code>inthecode.</p><blockquote><p>Noticethe<codeclass="language-plaintexthighlighter-rouge">inline</code>modifier.ThismeansthatCisallowedtocompilethiscode‘inline’wherethefunctioncalloccurs,ratherthancompilingcodethatactuallyjumpstoafunctionandreturns.Syntactically,ineveryway,it’sjustlikeafunction-butmoreefficient.Greatfortinyfunctionslikethisone,whereit’sworthduplicatingthecode(makingtheexecutablebigger)tosavetime(makingtheprogramrunslightlyfaster).</p></blockquote><p>Anyway,atstrategicpointsinthecode,Imakeacalllikethisone:</p><divclass="language-chighlighter-rouge"><divclass="highlight"><preclass="highlight"><code><spanclass="n">logr</span><spanclass="p">(</span><spanclass="s">"Fetched"</span><spanclass="p">,</span><spanclass="n">page</span><spanclass="o">-&gt;</span><spanclass="n">depth</span><spanclass="p">,</span><spanclass="n">page</span><spanclass="o">-&gt;</span><spanclass="n">url</span><spanclass="p">);</span></code></pre></div></div><h3id="contents-of-pagedirectory-after-crawler-has-run">ContentsofpageDirectoryaftercrawlerhasrun</h3><p>ForeachURLcrawledtheprogramcreatesafileandplacesinthefiletheURLandfilenamefollowedbyallthecontentsofthewebpage.ButforamaxDepth=1asinthisexamplethereareonlyafewwebpagescrawledandfilescreated.Belowisapeekatthefilescreatedduringtheabovecrawl.NoticehoweachpagestartswiththeURL,thenanumber(thedepthofthatpageduringthecrawl),thenthecontentsofthepage(hereIprintedonlythefirstlineofthecontent).</p><divclass="language-plaintexthighlighter-rouge"><divclass="highlight"><preclass="highlight"><code>$ls123$head-31http://old-www.cs.dartmouth.edu/~cs50/index.html0&lt;!DOCTYPEhtml&gt;$head-32http://old-www.cs.dartmouth.edu/~dfk/1&lt;!DOCTYPEHTMLPUBLIC"-//W3C//DTDHTML4.01Transitional//EN""http://www.w3.org/TR/html4/loose.dtd"&gt;$head-33http://old-www.cs.dartmouth.edu/~cs50/1&lt;!DOCTYPEhtml&gt;</code></pre></div></div><h2id="organization-of-the-tse-code">OrganizationoftheTSEcode</h2><p>Let’stakealookatthestructureoftheTSEsolution-soyoucanseewhatyou’reaimingfor.</p><h3id="directory-structure">Directorystructure</h3><p>MyTSEcomprisessixsubdirectories:</p><ul><li><strong>libcs50</strong>-alibraryofcodeweprovide</li><li><strong>common</strong>-alibraryofcodeyouwrite</li><li><strong>crawler</strong>-thecrawler</li><li><strong>indexer</strong>-theindexer</li><li><strong>querier</strong>-thequerier</li><li><strong>data</strong>-withsubdirectorieswherethecrawlerandindexercanwritefiles,andthequeriercanreadfiles.</li></ul><p>Mytop-level<codeclass="language-plaintexthighlighter-rouge">.gitignore</code>fileexcludes<codeclass="language-plaintexthighlighter-rouge">data</code>fromtherepository,becausethedatafilesarebig,changingoften,anddon’tdeservetobesaved.</p><p>Thefulltreelookslikethis:</p><divclass="language-plaintexthighlighter-rouge"><divclass="highlight"><preclass="highlight"><code>├──common│  ├──index.c│  ├──index.h│  ├──Makefile│  ├──pagedir.c│  ├──pagedir.h│  ├──word.c│  └──word.h├──crawler│  ├──crawler.c│  ├──crawlertest.sh│  ├──Makefile│  └──README.md├──indexer│  ├──indexer.c│  ├──indexsort.awk│  ├──indexsort.sh│  ├──indextest.c│  ├──indextest.sh│  ├──Makefile│  └──README.md├──libcs50│  ├──bag.c│  ├──bag.h│  ├──counters.c│  ├──counters.h│  ├──file.c│  ├──file.h│  ├──file.md│  ├──hashtable.c│  ├──hashtable.h│  ├──jhash.c│  ├──jhash.h│  ├──Makefile│  ├──memory.c│  ├──memory.h│  ├──memory.md│  ├──README.md│  ├──set.c│  ├──set.h│  ├──webpage.c│  ├──webpage_fetch.c│  ├──webpage.h│  ├──webpage_internal.h│  └──webpage.md├──Makefile├──querier│  ├──fuzzquery.c│  ├──Makefile│  ├──querier.c│  ├──README.md│  └──testqueries└──README.md</code></pre></div></div><h4id="source-files">Sourcefiles</h4><p>Mycrawler,indexer,andqueriereachconsistofjustone<codeclass="language-plaintexthighlighter-rouge">.c</code>file.Theysharesomecommoncode,whichIkeepinthe<codeclass="language-plaintexthighlighter-rouge">common</code>directory:</p><ul><li><strong>pagedir</strong>-asuiteoffunctionstohelpthecrawlerwritepagestothepageDirectoryandhelptheindexerreadthembackin</li><li><strong>index</strong>-asuiteoffunctionsthatimplementthe“index”datastructure;thismoduleincludesfunctionstowriteanindextoafile(usedbyindexer)andreadanindexfromafile(usedbyquerier).</li><li><strong>word</strong>-afunction<codeclass="language-plaintexthighlighter-rouge">NormalizeWord</code>usedbyboththeindexerandthequerier.</li></ul><p>Eachoftheprogramdirectories(crawler,indexer,querier)includeafewfilesrelatedtotesting,aswell.</p><p>You’llrecognizetheLab3datastructures-they’reallinthe<codeclass="language-plaintexthighlighter-rouge">libcs50</code>library.Notetheflatterorganization-there’snotaseparatesubdirectory(withMakefileortestcode)foreachdatastructure.</p><h4id="makefiles">Makefiles</h4><p>Thestarterkitincludesa<codeclass="language-plaintexthighlighter-rouge">Makefile</code>atthetoplevelandanothertobuildthe<codeclass="language-plaintexthighlighter-rouge">libcs50</code>library.</p><p>Thetop-level<codeclass="language-plaintexthighlighter-rouge">Makefile</code>recursivelycallsMakeoneachofthesourcedirectories.</p><p>The<codeclass="language-plaintexthighlighter-rouge">libcs50/Makefile</code>demonstrateshowyoucanbuildalibrary,inthiscase<codeclass="language-plaintexthighlighter-rouge">libcs50.a</code>,fromacollectionofobject<codeclass="language-plaintexthighlighter-rouge">.o</code>files.StudythisMakefile,becauseyou’llneedtowritesomethingsimilarforyour<codeclass="language-plaintexthighlighter-rouge">common</code>directory.</p><p>Youcanthenlinktheselibrariesintoyourotherprogramswithouthavingtolistalltheindividual<codeclass="language-plaintexthighlighter-rouge">.o</code>filesonthecommandline.Forexample,whenIbuildmycrawlerMakerunscommandsasfollows:</p><divclass="language-plaintexthighlighter-rouge"><divclass="highlight"><preclass="highlight"><code>make-Ccrawlergcc-Wall-pedantic-std=c11-ggdb-DAPPTEST-I../libcs50-I../common-c-ocrawler.ocrawler.cgcc-Wall-pedantic-std=c11-ggdb-DAPPTEST-I../libcs50-I../commoncrawler.o../common/common.a../libcs50/libcs50.a-lcurl-ocrawler</code></pre></div></div><p>The<codeclass="language-plaintexthighlighter-rouge">crawler/Makefile</code>iswritteningoodstyle,withappropriateuseofvariables,sotherulethatcausesMaketoruntheabovecommandsisactuallymuchshorter:</p><divclass="language-plaintexthighlighter-rouge"><divclass="highlight"><preclass="highlight"><code>crawler:crawler.o$(LLIBS)$(CC)$(CFLAGS)$^$(LIBS)-o$@</code></pre></div></div><p>We’llworkmorewithMakefilesinupcomingclasses.</p><h2id="activity">Activity</h2><p>Intoday’s<ahref="activity.html">activity</a>yourgroupwillrunthecrawleroverasetofwebpagesandtrytounderstandwhyittakesthestepsitdoes.</p></div></article></div></div><footerclass="site-footer"><divclass="wrapper"><h2class="footer-heading">Engs50(CS50)--DartmouthCollege</h2><p><fontsize=-1>ThisversionofthecourseisbaseduponthosedesignedbyProfessorsPalmer,Kotz,Zhou,Campbell,andBalkcom.Iamdeeplyindebtedtotheseoutstandingeducators.--<ahref="https://engineering.dartmouth.edu/people/faculty/stephen-taylor/">StephenTaylor</a></font></p><p><small>Thispagewaslastupdatedon<strong>2023-01-05</strong>at<strong>11:31</strong>.</small></p></div></footer></body></html>
