https://thayer.github.io/engs50/Labs/Lab5/
2
23682
<!DOCTYPEhtml><html><head><metacharset="utf-8"><metahttp-equiv="X-UA-Compatible"content="IE=edge"><metaname="viewport"content="width=device-width,initial-scale=1"><title>Lab5-Indexer</title><metaname="description"content="InEngs50youwilllearnhowtodesign&buildlarge,reliable,maintainable,andunderstandablesoftwaresystems.IntheprocessyouwilllearntoprograminCwithUnixdevelopmenttools."><linkrel="shortcuticon"href="/engs50/50.png"/><linkrel="stylesheet"href="/engs50/css/main.css"><linkrel="canonical"href="/engs50/Labs/Lab5/"></head><body><headerclass="site-header"><aclass="site-title"href="/engs50/"><imgwidth=48align=centersrc="/engs50/50.png"alt="icon">Engs50(CS50)</a><navclass="site-nav">[<ahref="/engs50/Labs/">Labs</a>][<ahref="/engs50/Notes/">Notes</a>][<ahref="/engs50/Reading/">Reading</a>][<ahref="/engs50/Resources/">Resources</a>][<ahref="/engs50/Examples/">Examples</a>]</nav></header><divclass="page-content"><divclass="wrapper"><articleclass="post"><headerclass="post-header"><h1class="post-title">Lab5-Indexer</h1></header><divclass="post-content"><p><strong>DueFriday,May5,at10pm</strong></p><p>Inthislabyou’llcontinuetheTinySearchEngine(TSE)bycodingtheIndexerandaprogramfortestingaunitthatsavesandloadsindexfiles,accordingtothe<ahref="REQUIREMENTS.html">IndexerRequirementsSpec</a>.</p><ulid="markdown-toc"><li><ahref="#preparation"id="markdown-toc-preparation">Preparation</a></li><li><ahref="#assignment"id="markdown-toc-assignment">Assignment</a><ul><li><ahref="#whatsubmit"id="markdown-toc-whatsubmit">Submission-what</a></li><li><ahref="#howsubmit"id="markdown-toc-howsubmit">Submission-how</a></li><li><ahref="#extensions"id="markdown-toc-extensions">Extensions</a></li></ul></li><li><ahref="#hints-and-tips"id="markdown-toc-hints-and-tips">Hintsandtips</a><ul><li><ahref="#review-the-lecture-notes"id="markdown-toc-review-the-lecture-notes">Reviewthelecturenotes</a></li><li><ahref="#libcs50"id="markdown-toc-libcs50">libcs50</a></li><li><ahref="#markdown"id="markdown-toc-markdown">Markdown</a></li><li><ahref="#testing"id="markdown-toc-testing">Testing</a></li><li><ahref="#use-valgrind-and-gdb"id="markdown-toc-use-valgrind-and-gdb">Usevalgrindandgdb</a></li><li><ahref="#memory-allocation"id="markdown-toc-memory-allocation">Memoryallocation</a></li><li><ahref="#hashtable"id="markdown-toc-hashtable">Hashtable</a></li><li><ahref="#pagedirectory"id="markdown-toc-pagedirectory">pageDirectory</a></li><li><ahref="#index-files"id="markdown-toc-index-files">Indexfiles</a></li><li><ahref="#makefile"id="markdown-toc-makefile">Makefile</a></li></ul></li></ul><h2id="preparation">Preparation</h2><ol><li><p>StartwiththesameGitlabprojectyouusedforLab4.<em>Beforeyoubegin</em>,makesureyousubmittedLab4correctly:youtaggedthesubmittedversionwith<codeclass="language-plaintexthighlighter-rouge">lab4submit</code>,<ahref="/engs50/Labs/Lab4/#howsubmit">asinstructed</a>,andpushedthattagtoyourGitlabremote.</p></li><li><p>Checktoensureyourlocalrepoiscleanwith<codeclass="language-plaintexthighlighter-rouge">makeclean</code>andeverythinghasbeencommittedandpushedaccordingto<codeclass="language-plaintexthighlighter-rouge">gitstatus</code>.Ifyouhavefilesthatneedtobecommitted,orcommitsthatshouldbepushed,dothatnow.(oops-werethosesupposedtobepartofyourLab4submission?Seethefirststepabove.)</p></li><li><p><strong>Donotproceed</strong>ifyouhaveuncommittedchangesorunpushedcommits.SeekhelpifyouneedtosortoutyourrepoandGitlab.</p></li><li>Pulltheupdatedandadditionalfilesfromtheupstreammaster(theTSEstarterkit)intoyourlocalrepository:<codeclass="language-plaintexthighlighter-rouge">gitpullupstreammaster</code>(thisworksifyouearlierfollowedthe<ahref="/05/">instructionsfromSectionmeeting</a>).<blockquote><p><ahref="https://gitlab.cs.dartmouth.edu/CS50/tse/compare/341328cc0ba0501a0f53eabace60a5cdbbd5b762...HEAD">Here</a>youcanseethechangesthatwillhappenwhenyourunthiscommand-allthechangesmadetothestarterkitsinceitwasreleased.</p></blockquote></li><li><p>Commitandpushyourchanges;perhapstagthiscommitforeasyreferencelater:<codeclass="language-plaintexthighlighter-rouge">gitcommit-a;gittaglab5start;gitpush--tags</code>.</p></li><li>CheckagaintobesureyourGitlabrepois<strong><em>private</em></strong>(not<em>internal</em>or<em>public</em>).VisityourrepoonGitlab,clickon<em>Settings</em>,andscrolldownto<em>ProjectVisibility</em>.</li></ol><h2id="assignment">Assignment</h2><p>Writethe<em>indexer</em>,secondsub-systemoftheTinySearchEngine.Pleasefollowthe<ahref="/engs50/Resources/CodingStyle.html">CS50codingstyleguidelines</a>andthe<ahref="REQUIREMENTS.html">IndexerRequirementsSpec</a>,andmakegooduseofourabstractdatastructures.</p><p>NowisagoodtimetoreadSection4in<em><ahref="/engs50/Reading/searchingtheweb.pdf">SearchingtheWeb</a></em>,thepaperaboutsearchengines.</p><ol><li>Inthe<codeclass="language-plaintexthighlighter-rouge">indexer</code>subdirectory,write<ul><li>aprogram<codeclass="language-plaintexthighlighter-rouge">indexer</code>;</li><li>aprogram<codeclass="language-plaintexthighlighter-rouge">indextest</code>;</li><li>ashortfile<codeclass="language-plaintexthighlighter-rouge">README.md</code>toprovideanyspecialinformationaboutcompilingorusingyourindexerorindextestprograms;</li><li>afile<codeclass="language-plaintexthighlighter-rouge">DESIGN.md</code>toprovidetheDesignSpecforindexer(notindextester),drawinginspirationfromthe<ahref="/indexer/">lecturenotes</a>;</li><li>afile<codeclass="language-plaintexthighlighter-rouge">IMPLEMENTATION.md</code>toprovidetheimplementationspecandtestingplanforindexer(notindextester);</li><li>afile<codeclass="language-plaintexthighlighter-rouge">TESTING.md</code>,tellingthegraderhowyoutestedyourindexer(see<ahref="#testing">abouttesting</a>below);</li><li>a<codeclass="language-plaintexthighlighter-rouge">.gitignore</code>filetellingGittoignorethebinaryfiles(libraries,executables)inthisdirectory.</li></ul></li><li><p>Bothprogramsshallleveragecommoncodefrom<codeclass="language-plaintexthighlighter-rouge">common.a</code>inthe<codeclass="language-plaintexthighlighter-rouge">../common</code>directory:</p><ul><li>amodule<codeclass="language-plaintexthighlighter-rouge">index.c</code>thatcontainsallthelogicforsavingandloadingindexfiles(thismoduleiscommonbetweentheIndexer,Querier,andindextest);</li><li>amodule<codeclass="language-plaintexthighlighter-rouge">pagedir.c</code>thatcontainsallthelogicforsavingpagestoacrawleroutputdirectory,forloadingpagesfromacrawleroutputdirectory(thismoduleiscommonbetweentheCrawlerandIndexer);</li><li>(optionally)amodule<codeclass="language-plaintexthighlighter-rouge">word.c</code>thatimplements<codeclass="language-plaintexthighlighter-rouge">NormalizeWord</code>(thismoduleiscommonbetweentheIndexerandQuerier);</li><li>a<codeclass="language-plaintexthighlighter-rouge">Makefile</code>thatbuilds<codeclass="language-plaintexthighlighter-rouge">common.a</code>forusebytheprograms;</li><li>ashort<codeclass="language-plaintexthighlighter-rouge">README.md</code>fileexplaininghowtobuild<codeclass="language-plaintexthighlighter-rouge">common.a</code>;</li><li>a<codeclass="language-plaintexthighlighter-rouge">.gitignore</code>filetellingGittoignorethebinaryfiles(libraries,executables)inthisdirectory.</li></ul></li><li>Reviewyourtop-level<codeclass="language-plaintexthighlighter-rouge">README.md</code>and<codeclass="language-plaintexthighlighter-rouge">Makefile</code>toupdateasneeded.</li></ol><h3id="whatsubmit">Submission-what</h3><p>Inthislabyoushalleditoraddfilesasdescribedabove.<strong><em>Youmustarrangeyourdirectorylikeours,sowecanbetternavigateandtestyourcode.</em></strong>Ofcourse,youmayhaveadditionalfiles-testscripts,testoutput,codeyou’vechosentobreakintomultiplefiles.Hereisthesolution’s<ahref="/engs50/Labs/Lab5/tse-tree.txt">directorystructure</a>;itincludessomeoftheoptionalfilesandsomeofthetestingfiles,whichmaynotbepresentinyoursolution.Thepointisthatyourcodemustbeorganizedinthesame<em>directory</em>structure.</p><p><em>YoushallNOTmodifyanyofthecodeweprovidein<codeclass="language-plaintexthighlighter-rouge">libcs50</code></em>.</p><p><em>YoushallNOTincludeanydatafilesproducedbythecrawlerorindexer,oranybinary/objectfilesproducedbythecompiler,backupfiles,coredumps,etc.</em></p><h3id="howsubmit">Submission-how</h3><p>Whenyouarereadyforfinalsubmission,</p><ul><li><strong>Add</strong>allrequiredfilesusinganappropriate<codeclass="language-plaintexthighlighter-rouge">gitadd</code>commandline.</li><li><strong>Commit</strong>allchangesusinganappropriate<codeclass="language-plaintexthighlighter-rouge">gitcommit</code>commandline.</li><li><strong>Tag</strong>:<codeclass="language-plaintexthighlighter-rouge">gittaglab5submit</code></li><li><strong>Push</strong>:<codeclass="language-plaintexthighlighter-rouge">gitpush--tags</code>toensurethetagsarepushedtotheremote.See<ahref="/git/tags.html">moreabouttags</a>.</li></ul><p>UseyourwebbrowsertoviewyourremoteonGitlabandmakesurethereisatag<codeclass="language-plaintexthighlighter-rouge">lab5submit</code>andthefilesassociatedwiththattaggedcommitincludeeverythingwe’llneedtogradeyourlab.</p><p>Wegradetheversiontagged<codeclass="language-plaintexthighlighter-rouge">lab5submit</code>soitissafeforyoutocontinuework(e.g.,soyoucanstartworkonLab6),evenifyoucommitorpush.</p><p>Wewillcloneyourrepoat0h,24h,48h,and72haftertheoriginaldeadline.Wewillstartgradingwhenwefirstseeonewithtag<codeclass="language-plaintexthighlighter-rouge">lab5submit</code>,andjudgeitlateifthattagwasaddedafterthedeadline.Toavoidconfusion,<em>pleaseblitztheteam<codeclass="language-plaintexthighlighter-rouge">cs50ATcs.dartmouth.edu</code>ifyouwantalatesubmissiontobegradedinsteadofyouron-timesubmission.</em></p><p><strong><em>Yourentirecodebasemustcompilewith<codeclass="language-plaintexthighlighter-rouge">make</code>fromthetop-leveldirectoryandproducenocompilerwarnings.</em></strong>Ifwefindthatyourcodewillnotcompile,orhas<strong>segmentationfaults</strong>,wewillsenditbacktoyouassoonaswecanforrepair;recallthe<ahref="/#crashes">gradingpolicy</a>.</p><p>Wewillrunyourindexeronourownsetoftestdata.</p><p>Wewillrun<codeclass="language-plaintexthighlighter-rouge">valgrind</code>onyourprogramtolookformemoryleaks;youwilllosepointsformemoryleaksormemoryerrors.</p><h3id="extensions">Extensions</h3><p>Ifyouwanttoclaimyourextension,createafile<codeclass="language-plaintexthighlighter-rouge">EXTENSION</code>atthetop-leveldirectoryofyourrepository.Don’tforgetto<codeclass="language-plaintexthighlighter-rouge">gitpush</code><em>(beforethedeadline!)</em>sowewillseethefile.Forexample,</p><divclass="language-bashhighlighter-rouge"><divclass="highlight"><preclass="highlight"><code><spanclass="nv">$</span><spanclass="nb">touch</span>EXTENSION<spanclass="nv">$</span>gitaddEXTENSION<spanclass="nv">$</span>gitcommit<spanclass="nt">-m</span><spanclass="s2">"extensionrequest"</span><spanclass="nv">$</span>gittaglab5submit<spanclass="c">#addtag,asabove</span><spanclass="nv">$</span>gitpush<spanclass="nt">--tags</span><spanclass="c">#pushtogitlab,includingtags</span></code></pre></div></div><p>UseyourwebbrowsertoviewyourremoteonGitlabandmakesurethereisatag<codeclass="language-plaintexthighlighter-rouge">lab5submit</code>andthatitsfilesinclude<codeclass="language-plaintexthighlighter-rouge">EXTENSION</code>.</p><p>Whenyouarereadytosubmityourcode,remove<codeclass="language-plaintexthighlighter-rouge">EXTENSION</code>asfollows,<em>updateyoursubmissiontag</em>,andpushtoGitlab:</p><divclass="language-bashhighlighter-rouge"><divclass="highlight"><preclass="highlight"><code><spanclass="nv">$</span>git<spanclass="nb">rm</span>EXTENSION<spanclass="nv">$</span>gitcommit<spanclass="nt">-m</span><spanclass="s2">"readyforgrading"</span><spanclass="nv">$</span>gitpush<spanclass="nt">--delete</span>originlab5submit<spanclass="c">#removethetagfromremote</span><spanclass="nv">$</span>gittag<spanclass="nt">-f</span>lab5submit<spanclass="c">#movethelocaltagforwardtothiscommit</span><spanclass="nv">$</span>gitpush<spanclass="nt">--tags</span><spanclass="c">#pushtogitlabremote,includingtags</span></code></pre></div></div><p>UseyourwebbrowsertoviewyourremoteonGitlabandmakesurethereisatag<codeclass="language-plaintexthighlighter-rouge">lab5submit</code>,thatitsfilesdo<em>not</em>include<codeclass="language-plaintexthighlighter-rouge">EXTENSION</code>,anditsfilesincludeeverythingwe’llneedtogradeyourlab.</p><h2id="hints-and-tips">Hintsandtips</h2><h3id="review-the-lecture-notes">Reviewthelecturenotes</h3><p>Therearesomedesigntipsinthe<ahref="/indexer/">lecturenotes</a>.Thisweek’s<ahref="/engs50/Reading/#week-6">reading</a>isgreattoo!</p><h3id="libcs50">libcs50</h3><p>Weprovideseveralmodulesinthe<codeclass="language-plaintexthighlighter-rouge">libcs50</code>directory,whichcompilestoalibrary<codeclass="language-plaintexthighlighter-rouge">libcs50.a</code>youcanlinkwithyourindexer.<em>Youshouldnotchangeanyofourcode.</em>Youmaydropinyour<codeclass="language-plaintexthighlighter-rouge">set.[ch]</code>,<codeclass="language-plaintexthighlighter-rouge">counters.[ch]</code>,<codeclass="language-plaintexthighlighter-rouge">hashtable.[ch]</code>filesfromLab3.Ifyou’dprefertouseourversionof<em>set</em>,<em>counters</em>,and<em>hashtable</em>,that’stotallyfine;thestarterkitincludesapre-compiledlibraryyoucanuseinstead;see<codeclass="language-plaintexthighlighter-rouge">libcs50/README.md</code>.</p><p>MostofthemodulesinthisdirectoryaredocumentedwithacorrespondingMarkdownfile.</p><h3id="markdown">Markdown</h3><p>Inthisandsubsequentlabs,youmustprovidedocumentationfilesinMarkdownformat,thatis,youshouldsupply<codeclass="language-plaintexthighlighter-rouge">README.md</code>,<codeclass="language-plaintexthighlighter-rouge">DESIGN.md</code>,<codeclass="language-plaintexthighlighter-rouge">IMPLEMENTATION.md</code>,and<codeclass="language-plaintexthighlighter-rouge">TESTING.md</code>.TheMarkdownsyntaxprovidesverysimple(andreadable)markupforheadings,lists,italics,bold,andcodesnippets.(ThiscoursewebsiteiswritteninMarkdown.)See<ahref="/engs50/Resources/#markdown">Markdownresources</a>.</p><h3id="testing">Testing</h3><p>Ifyourcrawlerneverquiteworked,neverfear!Youdonotneedaworkingcrawlertowriteortestyourindexer.Tryyourindexeronthecrawler’soutput,whichisin<codeclass="language-plaintexthighlighter-rouge">~cs50/demo/crawler-output/</code>.</p><p>Werecommendthatyouwriteabashscripttoexecuteyourindexer;youmightrunthatscriptfroma<codeclass="language-plaintexthighlighter-rouge">maketest</code>target.Your<codeclass="language-plaintexthighlighter-rouge">TESTING.md</code>filecannamethescriptanddescribewhatitdoes.</p><p>Becausesomeofourdata-structureimplementationshaveunspecifiedordering–theorderinwhichdataappearswhentraversingthestructuremaynotbethesameastheorderitemswereinserted–thefilesavedbytheindextestermaynotbeliterallyidenticaltothefilereadbythatprogram.Weprovidean<ahref="/engs50/Labs/Lab5/indexsort.awk"><codeclass="language-plaintexthighlighter-rouge">indexsort.awk</code></a>scriptthatsortstheindexfileintoa‘canonical’ordering,makingitpossibletocomparetwoindexfilesfortheircontent.</p><p>Notethat<codeclass="language-plaintexthighlighter-rouge">TESTING.md</code>isdifferentfromthe‘Testingplan’,whichisashorthigh-leveldescriptionwrittenbeforeyoucode.<codeclass="language-plaintexthighlighter-rouge">TESTING.md</code>contains(orrefersto)resultsfromthetests.Itmayrefertootherfilesthatcontaininputtooroutputfromyourtestruns,orscriptstorunthetests;theyneednotbecopiedintothisfile.(Indeed,yourfilewillbemuchmorereadableifyoudon’tfillitwithlongscriptsoroutput!)</p><h3id="use-valgrind-and-gdb">Usevalgrindandgdb</h3><p>In<ahref="/debug/">Lecture</a>welearnedhowtouse<codeclass="language-plaintexthighlighter-rouge">valgrind</code>and<codeclass="language-plaintexthighlighter-rouge">gdb</code>;makeuseofthem.</p><h3id="memory-allocation">Memoryallocation</h3><p>Youmayfindthe<codeclass="language-plaintexthighlighter-rouge">memory.c</code>moduleuseful.Itsuseisoptional,butitisreadytouseaspartoflibrary<codeclass="language-plaintexthighlighter-rouge">libcs50.a</code>.</p><p>InourLab3wetriedtorecovergracefullyfrommemory-allocationfailures.IntheTSEapplicationprograms,we’llbeabitmorelazy:onNULLreturnfrommalloc/callocyoucanprintanerrorandexitwithnon-zeroexitstatus.(Youmayfindthe<codeclass="language-plaintexthighlighter-rouge">assertp()</code>function,definedbythe<codeclass="language-plaintexthighlighter-rouge">memory</code>module,tobeusefulhere.)</p><h3id="hashtable">Hashtable</h3><p>“Howbigshouldthehashtablebe?”</p><p>Intheindexer/querier,weuseahashtabletostoreaninvertedindex(words–&gt;documents),andthusthehashtableiskeyedbywords.Theanswertotheabovequestion,then,dependsonhowmanywordswillbeintheindex.</p><p>Whenbuildingtheinvertedindex,it’simpossibletoknowinadvancehowmanywordsyouwillfindinallthosepagesencounteredbythecrawler.Pickareasonablesize,perhapssomethingintherangeof200..900slots.</p><p>Whenloadinganinvertedindexfromafile,though,you<em>can</em>knowhowmanywords…becausethereisonewordperlineintheindexfile,andit’seasytocountthenumberoflines(see<codeclass="language-plaintexthighlighter-rouge">file.c</code>).Onceyourcodecanobtainthenumberofwords,thinkabouthowitcancomputeagoodsizeforyourhashtable.</p><h3id="pagedirectory">pageDirectory</h3><p>RecallthattheCrawlerfillsadirectorywithsavedpages;inLab4werecommendedthatyoualsocreateandleaveafile<codeclass="language-plaintexthighlighter-rouge">.crawler</code>inthepagedirectory.Ifyoufollowedthatadvice,younowhaveagreatopportunity!Youmightincludeafunction<codeclass="language-plaintexthighlighter-rouge">isCrawlerDirectory(char*dir)</code>inyour<codeclass="language-plaintexthighlighter-rouge">pagedir</code>module,whichcaneasilyverifywhether<codeclass="language-plaintexthighlighter-rouge">dir</code>isindeedaCrawler-produceddirectory.Ifitcanopenafile<codeclass="language-plaintexthighlighter-rouge">dir/.crawler</code>forreading,then<codeclass="language-plaintexthighlighter-rouge">dir</code>isaCrawler-produceddirectory;ifnot,eitherthe<codeclass="language-plaintexthighlighter-rouge">dir</code>isnotavalidpathname,notadirectory,notareadabledirectory,it’snotaCrawlerproduceddirectory,orsomeothererror-alleasilycaughtbythissimpletest.</p><h3id="index-files">Indexfiles</h3><p>Toreadeachlineoftheindexfile,itworkswelltoreadtheword,thenloopcalling<codeclass="language-plaintexthighlighter-rouge">fscanf</code>withformat<codeclass="language-plaintexthighlighter-rouge">"%d%d"</code>topulloffonepairatatime,checkingthereturnvalueof<codeclass="language-plaintexthighlighter-rouge">fscanf</code>.</p><p>Towritetheindexfile,usethe<codeclass="language-plaintexthighlighter-rouge">_iterate</code>methodsbuiltintoyourdatastructures.(Indeedyoumayneedtohaveiteratorscalliterators!)Do<em>not</em>useyour<codeclass="language-plaintexthighlighter-rouge">_print</code>methodsforthispurpose;thosearemeantforproducingprettyhuman-readableoutputfordebuggingpurposes.</p><p>Thefunctionsfoundin<codeclass="language-plaintexthighlighter-rouge">file.c</code>shouldbehelpful.</p><h3id="makefile">Makefile</h3><p>Your<codeclass="language-plaintexthighlighter-rouge">indexer/Makefile</code>needstobuildboth<codeclass="language-plaintexthighlighter-rouge">indexer</code>and<codeclass="language-plaintexthighlighter-rouge">indextest</code>.Itmaybemostconvenienttoaddaphonytop-mostrule:</p><divclass="language-makehighlighter-rouge"><divclass="highlight"><preclass="highlight"><code><spanclass="nl">all</span><spanclass="o">:</span><spanclass="nf">indexerindextest</span></code></pre></div></div><p>sothat<codeclass="language-plaintexthighlighter-rouge">make</code>or<codeclass="language-plaintexthighlighter-rouge">makeall</code>willbuildbothprograms;ifyouwanttobuildjustone,run<codeclass="language-plaintexthighlighter-rouge">makeindexer</code>or<codeclass="language-plaintexthighlighter-rouge">makeindextest</code>.</p><p>Youmayalsofinditusefultoaddphonyrulessoyoucan<codeclass="language-plaintexthighlighter-rouge">maketest</code>or<codeclass="language-plaintexthighlighter-rouge">makevalgrind</code>.</p><p>Goodluck!</p></div></article></div></div><footerclass="site-footer"><divclass="wrapper"><h2class="footer-heading">Engs50(CS50)--DartmouthCollege</h2><p><fontsize=-1>ThisversionofthecourseisbaseduponthosedesignedbyProfessorsPalmer,Kotz,Zhou,Campbell,andBalkcom.Iamdeeplyindebtedtotheseoutstandingeducators.--<ahref="https://engineering.dartmouth.edu/people/faculty/stephen-taylor/">StephenTaylor</a></font></p><p><small>Thispagewaslastupdatedon<strong>2023-01-05</strong>at<strong>11:31</strong>.</small></p></div></footer></body></html>
